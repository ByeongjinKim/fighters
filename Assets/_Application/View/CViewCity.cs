using System.Collections;
using System.Collections.Generic;
using UnityEngine.UI;
using UnityEngine;

//-----------------------------------------------------------------------------------------------------------------------------------
// 도시 정보를 처리하기 위한 클래스
//-----------------------------------------------------------------------------------------------------------------------------------
public class CViewCity : ViewPanel
{
	//-------------------------------------------------------------------------------------------------------------------------------
	// -
	//-------------------------------------------------------------------------------------------------------------------------------
	[System.Serializable]
	public class tagData : _tagData
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		public tagCityStatic	citystatic		= (null);

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		public uiCity			city			= (null);
		public uiIcon			nation			= (null);
		public Text				면적				= (null);
		public Text				인구				= (null);
		public Text				GDP				= (null);
		public Text				시장_등급			= (null);
		public Text				구매력			= (null);
		public Text				물가				= (null);

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		public objControl		transfer		= (null);

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	};
	public tagData		data		= new tagData();

	//-------------------------------------------------------------------------------------------------------------------------------
	// 인터페이스를 활성화 하기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public bool ON( tagCityStatic citystatic )
	{
		/*
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( !app.CityStatic.Is(citystatic) ) return false;

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		bool isChange = (data.citystatic)!=(citystatic) || !Is(true);

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		(data.citystatic)	= (citystatic);

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( base.ON(data) )
		{
			//-----------------------------------------------------------------------------------------------------------------------
			// -
			//-----------------------------------------------------------------------------------------------------------------------
//			ForeBack();

			//-----------------------------------------------------------------------------------------------------------------------
			// -
			//-----------------------------------------------------------------------------------------------------------------------
//			app.Canvas.FullscreenScrollViewInit( ScrollView()._RectTransform() );

			//-----------------------------------------------------------------------------------------------------------------------
			// -
			//-----------------------------------------------------------------------------------------------------------------------
		}

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( isChange )
		{
			Fullscreen( new historyCity(citystatic) );
		}

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		City().Set(Get());
		Nation().Set(Get().Nation());

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		(data.면적.text)			= Func.NumberFormat(Get().extent);
		(data.인구.text)			= Func.NumberUnit(Get().population);
//		(data.GDP.text)			= Func.NumberFormat( Mathf.RoundToInt( (Get().gdp)/(100000000f)*(Get().population) ) );
//		(data.GDP.text)			= Func.NumberFormat( Mathf.RoundToInt( (Get().gdp)/(1000000000f)*(Get().population) ) )+" t";
		(data.GDP.text)			= Func.NumberUnit( ((long)(Get().gdp))*(Get().population) );
		(data.시장_등급.text)		= Get().GetMarketLevel().ToString();
		(data.구매력.text)		= Get().GetPurchaseLevel().ToString();
		(data.물가.text)			= Get().inflation.ToString();

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		TransferRefresh();

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		*/
		return base.ON();
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 네비게이션을 처리하기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public override void ONNAVIGATION()
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		app.ViewNavigation.ON( (this), app.Language.Get(Get().Name()) );

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 인터페이스가 전면에 출력되었을 때 반응하기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public override void ONFORE()
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		app.ViewBottom.Fore();

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 인터페이스를 비활성화 하기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public override bool OFF()
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( Is(true) )
		{
			//-----------------------------------------------------------------------------------------------------------------------
			// -
			//-----------------------------------------------------------------------------------------------------------------------
			(data.city)	= (null);

			//-----------------------------------------------------------------------------------------------------------------------
			// -
			//-----------------------------------------------------------------------------------------------------------------------
			return base.OFF();
		}

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		return false;
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 도시 정보를 얻기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public tagCityStatic Get()
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		return (data.citystatic);

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 국가 객체를 얻기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public uiCity City()
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		return (data.city);

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 국가 객체를 얻기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public uiIcon Nation()
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		return (data.nation);

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 도시 이동 버튼을 새로고침 하기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public void TransferRefresh()
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( app.Player.City()==Get() )
		{
			(data.transfer.Image().material)	= (Resources.Load(PATH.UI_MATERIAL_GRAY) as Material);
			data.transfer.Image().material.SetFloat( "_Power", (1) );
			(data.transfer.Text().text)			= app.Language.Get(TEXT.현재_도시);
			(data.transfer.Text().color)		= Func.Color( (225), (225), (225) );
		}
		else
		if( !app.City.IsTransfer(Get()) )
		{
			(data.transfer.Image().material)	= (Resources.Load(PATH.UI_MATERIAL_GRAY) as Material);
			data.transfer.Image().material.SetFloat( "_Power", (1) );
			(data.transfer.Text().text)			= app.Language.Get(TEXT.이동할_수_없음);
			(data.transfer.Text().color)		= Func.Color( (225), (225), (225) );
		}
		else
		{
			(data.transfer.Image().material)	= (null);
			(data.transfer.Text().text)			= app.Language.Get(TEXT.이_도시로_이동하기);
			(data.transfer.Text().color)		= (Color.white);
		}

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 인터페이스를 활성화 하기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public override void OnHistory( tagHistory _history )
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( (_history)==(null) ) return;

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		historyCity	history = (_history as historyCity);
		if( (history)!=(null) )
		{
			ON( history.city );
		}

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 취소 입력에 반응하기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public override bool ONCANCEL( CANCEL Cancel )
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( Is() )
		{
			return base.ONCANCEL( Cancel );
		}

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		return false;
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 인터페이스를 활성화 하기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public override bool ONCONTROL( objControl control, CONTROL_ACTION Action, tagFocus focus )
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( (control)==(null) ) return false;

		//---------------------------------------------------------------------------------------------------------------------------
		// 국가 (NATION)
		//---------------------------------------------------------------------------------------------------------------------------
		if( (control)==Nation().Control() && (Action)==(CONTROL_ACTION.SELECT) )
		{
			app.ViewNation.ON(Get().Nation());
			return true;
		}

		//---------------------------------------------------------------------------------------------------------------------------
		// 국가 (NATION)
		//---------------------------------------------------------------------------------------------------------------------------
		if( (control)==(data.transfer) && (Action)==(CONTROL_ACTION.SELECT) )
		{
			//-----------------------------------------------------------------------------------------------------------------------
			// -
			//-----------------------------------------------------------------------------------------------------------------------
			if( !app.City.IsTransfer(Get()) )
			{
				app.Confirm.ON( app.Language.Get(TEXT.이_도시로_이동하는_것은_허용되지_않습니다) );
			}
			else
			if( app.Player.City()!=Get() )
			{
//				app.ViewIndigator.ON( (app.City), Func.Script( app.Language.Get(TEXT.__로_이동중입니다), app.Language.Get(app.City.GetName(Get())) ) );
				app.ViewWorldMap.Transfer( Get() );
			}

			//-----------------------------------------------------------------------------------------------------------------------
			// -
			//-----------------------------------------------------------------------------------------------------------------------
			return true;
		}

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		return false;
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 메모리를 초기화 하기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public override void Unloader()
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		(data.city)			= (null);
		(data.nation)		= (null);
		(data.면적)			= (null);
		(data.인구)			= (null);
		(data.GDP)			= (null);
		(data.시장_등급)		= (null);
		(data.구매력)		= (null);
		(data.물가)			= (null);

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		(data.transfer)		= (null);

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 인터페이스를 불러오기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public override void Loader()
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		base.Loader( Resources.Load("ApplicationLoader/View/ViewCity"), (play.uiCanvas) );

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		(data.city)			= (Func.Get( _Transform(), "Left-Top/City" ).GetComponent(typeof(uiCity)) as uiCity);
		(data.nation)		= (Func.Get( _Transform(), "Left-Top/Nation" ).GetComponent(typeof(uiIcon)) as uiIcon);
		(data.면적)			= (Func.Get( _Transform(), "Left-Top/면적/Value" ).GetComponent(typeof(Text)) as Text);
		(data.인구)			= (Func.Get( _Transform(), "Left-Top/인구/Value" ).GetComponent(typeof(Text)) as Text);
		(data.GDP)			= (Func.Get( _Transform(), "Left-Top/GDP/Value" ).GetComponent(typeof(Text)) as Text);
		(data.시장_등급)		= (Func.Get( _Transform(), "Left-Top/시장 등급/Value" ).GetComponent(typeof(Text)) as Text);
		(data.구매력)		= (Func.Get( _Transform(), "Left-Top/구매력/Value" ).GetComponent(typeof(Text)) as Text);
		(data.물가)			= (Func.Get( _Transform(), "Left-Top/물가/Value" ).GetComponent(typeof(Text)) as Text);

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		(data.transfer)		= (Func.Get( _Transform(), "Transfer" ).GetComponent(typeof(objControl)) as objControl);

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// -
	//-------------------------------------------------------------------------------------------------------------------------------
}

//-----------------------------------------------------------------------------------------------------------------------------------
// -
//-----------------------------------------------------------------------------------------------------------------------------------