using System.Collections;
using System.Collections.Generic;
using System.Xml;
using UnityEngine;

//-----------------------------------------------------------------------------------------------------------------------------------
// 리소스 정보를 처리하기 위한 클래스
//-----------------------------------------------------------------------------------------------------------------------------------
public class CResource : AppsItemListener
{
	//-------------------------------------------------------------------------------------------------------------------------------
	// -
	//-------------------------------------------------------------------------------------------------------------------------------
	[System.Serializable]
    public class tagData : _tagData
    {
	    //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		public List<tagResource>	Resources		= new List<tagResource>();

	    //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
    };
    public tagData		data		= new tagData();

	//-------------------------------------------------------------------------------------------------------------------------------
	// -
	//-------------------------------------------------------------------------------------------------------------------------------
	void Awake()
	{
	    //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		Initialize( (data), "Resources", UPDATE_CLASS.Resource.ToString(), (null) );

	    //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
    // 리소스 정보를 생성하기 위한 함수 
	//-------------------------------------------------------------------------------------------------------------------------------
    protected override tagAppsItem New()
    {
        //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
        return new tagResource();

        //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
    }

	//-------------------------------------------------------------------------------------------------------------------------------
	// 리소스 객체를 삭제하기 위한 함수 
	//-------------------------------------------------------------------------------------------------------------------------------
	protected override void OnDelete( tagAppsItem appsItem )
	{
        //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		if( (appsItem)==(null) ) return;

        //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		GetList().Remove( appsItem as tagResource );

        //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
    }

	//-------------------------------------------------------------------------------------------------------------------------------
	// 리소스 리스트를 얻기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public List<tagResource> GetList()
	{
        //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		return (data.Resources);

        //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
	}

    //-------------------------------------------------------------------------------------------------------------------------------
	// 모델 정보를 검색하기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
    public tagResource Find( string id )
    {
        //---------------------------------------------------------------------------------------------------------------------------
	    // -
	    //---------------------------------------------------------------------------------------------------------------------------
        if( (id)==(null) ) return (null);

        //---------------------------------------------------------------------------------------------------------------------------
	    // -
	    //---------------------------------------------------------------------------------------------------------------------------
        foreach( tagResource resource in GetList() )
        {
            //-----------------------------------------------------------------------------------------------------------------------
	        // -
	        //-----------------------------------------------------------------------------------------------------------------------
            if( (resource.id)==(id) )
            {
				return (resource);
            }

            //-----------------------------------------------------------------------------------------------------------------------
	        // -
	        //-----------------------------------------------------------------------------------------------------------------------
        }

        //---------------------------------------------------------------------------------------------------------------------------
	    // -
	    //---------------------------------------------------------------------------------------------------------------------------
		return (null);
    }

	//-------------------------------------------------------------------------------------------------------------------------------
	// 리소스를 불러오기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public object Load( tagResource resource, string src, System.Type type )
	{
        //---------------------------------------------------------------------------------------------------------------------------
	    // -
	    //---------------------------------------------------------------------------------------------------------------------------
		if( (resource)==(null) ) return (null);
		if( (src)==(null) ) return (null);
//		if( (type)==(null) ) return (null);		//(NULL)값을 허용함

        //---------------------------------------------------------------------------------------------------------------------------
	    // -
	    //---------------------------------------------------------------------------------------------------------------------------
		if( Func.Is(src) && (resource.AssetBundle().bundle)!=(null) )
		{
			if( (type)!=(null) )
			{
				return resource.AssetBundle().bundle.LoadAsset( (src), (type) );
			}
			else
			{
				return resource.AssetBundle().bundle.LoadAsset(src);
			}
		}

        //---------------------------------------------------------------------------------------------------------------------------
	    // -
	    //---------------------------------------------------------------------------------------------------------------------------
		return (null);
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 리소스를 불러오기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public object Load( string resource, string src, System.Type type )
	{
        //---------------------------------------------------------------------------------------------------------------------------
	    // -
	    //---------------------------------------------------------------------------------------------------------------------------
		if( (resource)==(null) ) return (null);
		if( (src)==(null) ) return (null);
//		if( (type)==(null) ) return (null);		//(NULL)값을 허용함

        //---------------------------------------------------------------------------------------------------------------------------
	    // -
	    //---------------------------------------------------------------------------------------------------------------------------
		return Load( Find(resource), (src), (type) );
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 로컬에 저장된 정보를 불러오기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public override void OnLoadCache( tagAppsItem appsItem, AppsParameter col=(null) )
	{
        //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		if( (appsItem)==(null) ) return;
//		if( (col)==(null) ) return;	//(NULL)값을 허용함

        //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		tagResource		resource		= (appsItem as tagResource);
		if( (resource)==(null) ) return;

        //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		if( (col)!=(null) )
		{
			/*
			(model.vPos)			= col.GetVector2("position");
			(model.prev)			= col.Get("prev");
			(model.event_start)		= col.Get("event_start");
			(model.event_end)		= col.Get("event_end");
			AppsFunc.Parse( (stage.road_texture), col.Get("road_texture") );
			AppsFunc.Parse( (stage.road_mask), col.Get("road_mask") );
			(model.road_position)	= col.GetVector2("road_position");
			*/
		}

        //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		if( !GetList().Contains(resource) )
		{
			GetList().Add(resource);
		}

        //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// XML 파일을 저장하기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public override void OnXmlSave( XmlTextWriter xmlWriter, tagAppsItem appsItem )
	{
        //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		if( (xmlWriter)==(null) ) return;
		if( (appsItem)==(null) ) return;

        //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		tagResource		resource		= (appsItem as tagResource);
		if( (resource)==(null) ) return;

        //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		/*
		CXml.WriteNodeValue( (xmlWriter), "position",		(stage.vPos) );
		CXml.WriteNodeValue( (xmlWriter), "prev",			(stage.prev) );
		CXml.WriteNodeValue( (xmlWriter), "event_start",	(stage.event_start) );
		CXml.WriteNodeValue( (xmlWriter), "event_end",		(stage.event_end) );
		CXml.WriteNodeValue( (xmlWriter), "road_texture",	(stage.road_texture) );
		CXml.WriteNodeValue( (xmlWriter), "road_mask",		(stage.road_mask) );
		CXml.WriteNodeValue( (xmlWriter), "road_position",	(stage.road_position) );
		*/

        //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// XML 파일을 불러오기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public override void OnXmlLoad( XmlNode pNode, tagAppsItem appsItem )
	{
        //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		if( (pNode)==(null) ) return;
		if( (appsItem)==(null) ) return;

        //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		tagResource		resource		= (appsItem as tagResource);
		if( (resource)==(null) ) return;

        //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		/*
		(stage.vPos)			= CXml.GetChildValueVector2( (pNode), "position" );
		(stage.prev)			= CXml.GetChildValue( (pNode), "prev" );
		(stage.event_start)		= CXml.GetChildValue( (pNode), "event_start" );
		(stage.event_end)		= CXml.GetChildValue( (pNode), "event_end" );
		CXml.GetChildValue( (pNode), (stage.road_texture), "road_texture" );
		CXml.GetChildValue( (pNode), (stage.road_mask), "road_mask" );
		(stage.road_position)	= CXml.GetChildValueVector2( (pNode), "road_position" );
		*/

        //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
	}

	/*
	//-------------------------------------------------------------------------------------------------------------------------------
	// 아이템 이미지를 얻기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public Texture2D LoadItemImage( ITEM_TYPE Type )
	{
        //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		switch( Type )
		{
			//-----------------------------------------------------------------------------------------------------------------------
			// 골드 (GOLD)
			//-----------------------------------------------------------------------------------------------------------------------
			case (ITEM_TYPE.골드):
				return (app.Resource.Load( (RESOURCE.LUNAR_ICON), (RESOURCE.ICON_GOLD), typeof(Texture2D) ) as Texture2D);

			//-----------------------------------------------------------------------------------------------------------------------
			// 캐럿 (CARAT)
			//-----------------------------------------------------------------------------------------------------------------------
			case (ITEM_TYPE.유료_캐럿):
			case (ITEM_TYPE.무료_캐럿):
				return (app.Resource.Load( (RESOURCE.LUNAR_ICON), (RESOURCE.ICON_CARAT), typeof(Texture2D) ) as Texture2D);

			//-----------------------------------------------------------------------------------------------------------------------
			// -
			//-----------------------------------------------------------------------------------------------------------------------
			default:
				Debug.Log(Type);
				break;

			//-----------------------------------------------------------------------------------------------------------------------
			// -
			//-----------------------------------------------------------------------------------------------------------------------
		}				

        //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		return (null);
	}
	*/

	//-------------------------------------------------------------------------------------------------------------------------------
	// -
	//-------------------------------------------------------------------------------------------------------------------------------
}

//-----------------------------------------------------------------------------------------------------------------------------------
// -
//-----------------------------------------------------------------------------------------------------------------------------------