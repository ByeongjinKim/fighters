using System.Collections;
using System.Collections.Generic;
using UnityEngine;

//-----------------------------------------------------------------------------------------------------------------------------------
// 아이덴티티 정보를 처리하기 위한 클래스
//-----------------------------------------------------------------------------------------------------------------------------------
public class CIdentity : MonoBehaviour
{
	//-------------------------------------------------------------------------------------------------------------------------------
	// -
	//-------------------------------------------------------------------------------------------------------------------------------
    [System.Serializable]
    public class tagData
    {
	    //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		public tagIdentity			identity		= (null);

	    //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		public List<tagIdentity>	Identities		= new List<tagIdentity>();

	    //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
    };
    public tagData		data		= new tagData();

	//-------------------------------------------------------------------------------------------------------------------------------
	// -
	//-------------------------------------------------------------------------------------------------------------------------------
	protected CApp		app			= (null);
	protected CPlay		play		= (null);

	//-------------------------------------------------------------------------------------------------------------------------------
	// -
	//-------------------------------------------------------------------------------------------------------------------------------
	void OnEnable()
	{
		(this.app)		= (CApp.This);
		(this.play)		= (CPlay.This);
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 아이덴티티를 등록하기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public tagIdentity Register( tagPerson person )
	{
	    //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		if( (person)==(null) ) return (null);

	    //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		tagIdentity		identity	= Create();

	    //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		(identity.type)	= (IDENTITY.PERSON);
		(identity.obj)	= (person);

	    //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		GetList().Add(identity);

	    //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		return (identity);
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 아이덴티티를 등록하기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public tagIdentity Register( tagCompany company )
	{
	    //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		if( (company)==(null) ) return (null);

	    //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		tagIdentity identity = Find(company);
		if( (identity)!=(null) )
		{
			return (identity);
		}
		else
		{
			(identity) = Create();
		}

	    //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		(identity.type)	= (IDENTITY.COMPANY);
		(identity.obj)	= (company);

	    //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		GetList().Add(identity);

	    //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		if( !app.ViewLoading.Is() )
		{
			app.ViewDashboardBusiness.Reload();
		}

	    //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		return (identity);
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 아이덴티티를 생성하기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public tagIdentity Create()
	{
	    //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		return new tagIdentity();

	    //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 아이덴티티를 생성하기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public tagIdentity Create( IDENTITY nIdentity, string id )
	{
	    //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		if( !Func.Is(id) ) return (null);

	    //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		tagIdentity identity = new tagIdentity();

	    //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		(identity.type)	= (nIdentity);

	    //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		if( true )
		{
			//-----------------------------------------------------------------------------------------------------------------------
		    // -
		    //-----------------------------------------------------------------------------------------------------------------------
			switch( nIdentity )
			{
				//-------------------------------------------------------------------------------------------------------------------
			    // 인물 (PERSON)
			    //-------------------------------------------------------------------------------------------------------------------
				case (IDENTITY.PERSON):
					(identity.obj)	= app.Person.Find(id);
					break;

				//-------------------------------------------------------------------------------------------------------------------
			    // -
			    //-------------------------------------------------------------------------------------------------------------------
			}

			//-----------------------------------------------------------------------------------------------------------------------
		    // -
		    //-----------------------------------------------------------------------------------------------------------------------
			if( (identity.obj)==(null) )
			{
				(identity.obj)	= (id);
			}

			//-----------------------------------------------------------------------------------------------------------------------
		    // -
		    //-----------------------------------------------------------------------------------------------------------------------
		}

	    //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		return (identity);
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 리스트를 얻기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public List<tagIdentity> GetList()
	{
	    //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		return (data.Identities);

	    //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// -
	//-------------------------------------------------------------------------------------------------------------------------------
	public static IDENTITY Parse( string value )
	{
	    //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		if( !Func.Is(value) ) return (IDENTITY.NOTHING);

	    //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		(value)	= value.ToUpper();

	    //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		int End = (int)(IDENTITY.END);
		for( int i=0; i<(End); i++ )
		{
			if( ((IDENTITY)(i)).ToString()==(value) )
			{
				return (IDENTITY)(i);
			}
		}

	    //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		return (IDENTITY.NOTHING);
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 이름을 얻기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public string GetID( tagIdentity identity )
	{
	    //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		if( (identity)==(null) ) return (null);

	    //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		switch( identity.type )
		{
			//-----------------------------------------------------------------------------------------------------------------------
			// 기업 (COMPANY)
			//-----------------------------------------------------------------------------------------------------------------------
			case (IDENTITY.COMPANY):
				return app.Company.GetID(identity.Company());

			//-----------------------------------------------------------------------------------------------------------------------
			// 인물 (PERSON)
			//-----------------------------------------------------------------------------------------------------------------------
			case (IDENTITY.PERSON):
				return app.Person.GetID(identity.Person());

			//-----------------------------------------------------------------------------------------------------------------------
			// -
			//-----------------------------------------------------------------------------------------------------------------------
		}

	    //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		return (null);
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 사용자를 검색하기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public tagIdentity Find( IDENTITY type, string id=(null) )
	{
	    //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
//		if( !Func.Is(id) ) return (null);	//(NULL)값을 허용함

	    //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		foreach( tagIdentity identity in GetList() )
		{
			//-----------------------------------------------------------------------------------------------------------------------
			// -
			//-----------------------------------------------------------------------------------------------------------------------
			if( (identity.type)!=(type) ) continue;

			//-----------------------------------------------------------------------------------------------------------------------
			// -
			//-----------------------------------------------------------------------------------------------------------------------
			switch( identity.type )
			{
				//-------------------------------------------------------------------------------------------------------------------
				// 기업 (COMPANY)
				//-------------------------------------------------------------------------------------------------------------------
				case (IDENTITY.COMPANY):
					if( identity.ID()==(id) )
					{
						return (identity);
					}
					break;

				//-------------------------------------------------------------------------------------------------------------------
				// 인물 (PERSON)
				//-------------------------------------------------------------------------------------------------------------------
				case (IDENTITY.PERSON):
					return (identity);

				//-------------------------------------------------------------------------------------------------------------------
				// -
				//-------------------------------------------------------------------------------------------------------------------
			}

			//-----------------------------------------------------------------------------------------------------------------------
			// -
			//-----------------------------------------------------------------------------------------------------------------------
		}

	    //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		return (null);
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 사용자를 검색하기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public void Select( tagIdentity identity )
	{
	    //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		if( (identity)==(null) ) return;

	    //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		(data.identity)	= (identity);

	    //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		app.ViewTop.Set(identity);

	    //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 이름을 얻기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public tagIdentity Get()
	{
	    //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		return (data.identity);

	    //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 기업 정보를 얻기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public tagCompany Company()
	{
	    //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		tagIdentity	identity = Get();
		if( (identity)!=(null) && identity.Company()!=(null) )
		{
			return identity.Company();
		}

	    //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		if( app.Person.Is(app.Player.Person()) )
		{
			return app.Player.Person().Company();
		}

	    //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		return (null);
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 국가를 얻기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public tagNationStatic Nation()
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( Get()!=(null) )
		{
			if( (Get().type)==(IDENTITY.COMPANY) )
			{
				if( Get().Company()!=(null) && Func.Is(Get().Company().id) )
				{
					return (Get().Company().nation);
				}
			}
			else
			if( (Get().type)==(IDENTITY.PERSON) )
			{
				return app.Player.Nation();
			}
		}

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		return (null);
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 사용자를 확인하기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public bool Is( tagIdentity identity, tagPerson person )
	{
	    //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		if( (identity)==(null) ) return false;
		if( (person)==(null) ) return false;

	    //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		if( (identity.type)==(IDENTITY.PERSON) && identity.Person()==(person) )
		{
			return true;
		}

	    //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		return false;
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 사용자를 확인하기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public tagIdentity Find( tagCompany company )
	{
	    //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		if( (company)==(null) ) return (null);

	    //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		foreach( tagIdentity identity in GetList() )
		{
			if( (identity.type)==(IDENTITY.COMPANY) && identity.Company()==(company) )
			{
				return (identity);
			}
		}

	    //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		return (null);
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 자금 정보를 얻기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public decimal GetCash( tagIdentity identity )
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( (identity)==(null) ) return (0);

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		List<tagCash> Cashes = GetCashes(identity);
		if( (Cashes)!=(null) )
		{
			//-----------------------------------------------------------------------------------------------------------------------
			// -
			//-----------------------------------------------------------------------------------------------------------------------
			decimal cash = (0);

			//-----------------------------------------------------------------------------------------------------------------------
			// -
			//-----------------------------------------------------------------------------------------------------------------------
			foreach( tagCash cash0 in Cashes )
			{
				(cash) += Func.Divide( (cash0.value), (decimal)(cash0.currency.value) );
			}

			//-----------------------------------------------------------------------------------------------------------------------
			// -
			//-----------------------------------------------------------------------------------------------------------------------
			return (cash);
		}

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		return (0);
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 자금 정보를 얻기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public List<tagCash> GetCashes( tagIdentity identity )
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( (identity)==(null) ) return (null);

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( (identity.type)==(IDENTITY.COMPANY) )
		{
			tagCompany company = identity.Company();
			if( (company)!=(null) )
			{
				return (company.Cashes);
			}			
		}
		else
		if( (identity.type)==(IDENTITY.PERSON) )
		{
			tagPerson person = identity.Person();
			if( (person)!=(null) )
			{
				return (person.Cashes);
			}
		}

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		return (null);
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 자금 정보를 얻기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public List<tagCash> GetCashes()
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		return GetCashes( Get() );

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 자금 정보를 얻기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public decimal GetCash()
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		return GetCash( Get() );

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// -
	//-------------------------------------------------------------------------------------------------------------------------------
	public void Change( tagIdentity identity )
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( (identity)==(null) ) return;

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		app.ViewIndigator.ON( (this), app.Language.Get(TEXT.사용자를_전환중입니다) );
		ManagementHash.Identity( identity );

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 사용자가 경영자 유형인지 확인하기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public bool IsPerson()
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( Type()==(IDENTITY.PERSON) )
		{
			return true;
		}

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		return false;
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 사용자가 기업 유형인지 확인하기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public bool IsCompany()
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( Type()==(IDENTITY.COMPANY) )
		{
			return true;
		}

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		return false;
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 사용자가 기업 유형인지 확인하기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public IDENTITY Type()
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( Get()!=(null) )
		{
			return (Get().type);
		}

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		return (IDENTITY.NOTHING);
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// -
	//-------------------------------------------------------------------------------------------------------------------------------
}

//-----------------------------------------------------------------------------------------------------------------------------------
// -
//-----------------------------------------------------------------------------------------------------------------------------------